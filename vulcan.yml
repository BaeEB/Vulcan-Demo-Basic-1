--- # Start
name: example

# 유저의 github 저장소 정보
url:
docker-image:

# predefined docker-image를 사용하되, 추가적인 설정이 필요한 경우 이렇게 정의
extra-build-env-setting-commands:

test-candidates: |
  libyara/atoms.c

time-out: 3600
max-patch-number : 500

test-build-command: | # 테스트 빌드 커맨드 / defect4cpp 기준 meta.json의 내용이 필요  
  ./autogen.sh
  ./configure --prefix="/home/workspace/install"
  make -j10
  make install

coverage-build-command: | # 커버리지 빌드 커맨드 / defect4cpp 기준 meta.json의 내용이 필요(SBFL: gcov)
  ./autogen.sh
  CFLAGS="-Wno-error --coverage -g -O0" ./configure --prefix="/home/workspace/install"
  make -j10
  make install


# 테스트 type이 문제: gtest의 경우 원하는 테스트를 실행할 수 있으니 문제가 없음
# 그렇지 않으면 test-case에 실행할 테스트 번호를 range로 하도록함
# 테스트 실행 역시 range안에 있는 테스트들만 실행하도록 묶어서 command를 부르거나 여러번 불러야함
test-type: automake
test-list: | # 테스트 리스트 커맨드 / 테스트를 하나씩 실행하기 위해 테스트 리스트를 출력해주는 내용 필요
  index=1; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]
  index=2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]  
  index=3; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ] 
  index=4; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ] 
  index=5; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ] 
  index=6; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ] 
  index=7; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]  
  index=8; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]
  index=9; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]
  index=10; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]
  index=101; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]
  index=102; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ] 
  index=103; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ] 
  index=104; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ] 
  index=105; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]
  index=106; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ] 
  index=107; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]  
  index=108; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]
  index=109; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]
  index=110; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w tests/result/$(sed -n ${index}p .dpp/test_list) -v 2; example/ndpiReader -p example/protos.txt -c example/categories.txt -q -t -i tests/pcap/$(sed -n ${index}p .dpp/test_list) -w /tmp/reader.out -v 2; diff tests/result/$(sed -n ${index}p .dpp/test_list).out /tmp/reader.out; [ $? -eq 0 ]




test-case:

test-command: | # 테스트 실행
  bash -c "@testcase@"
test-coverage-command: | # 커버리지 테스트 실행 / 테스트 대상을 입력받아서 하나씩 실행할 수 있어야 함
  bash -c "@testcase@"
gcov-exclusion-list: | # 커버리지 제외 대상
  test*.o
