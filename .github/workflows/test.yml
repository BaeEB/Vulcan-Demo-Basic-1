name: regression test

on:
    # push:
    workflow_dispatch:
            
jobs:
    checkout:
        runs-on: self-hosted
        steps:
            - name: checkout source code
              uses: actions/checkout@v2
    build:
        needs: checkout
        runs-on: self-hosted
        steps:
            - name: run build
              run: |
                    rm -f Makefile
                    ./autogen.sh
                    make clean
                    make runtest -j10

    test:
        needs: build
        runs-on: self-hosted
        steps:
            - name: run test
              run: |
                    ./runtest "XML entity subst regression tests"
                    index=3; ./runtest "$(sed -n 3p .dpp/test_list)"
                    index=4; ./runtest "$(sed -n 4p .dpp/test_list)"
                    index=5; ./runtest "$(sed -n 5p .dpp/test_list)"
                    index=6; ./runtest "$(sed -n 6p .dpp/test_list)"
                    index=7; ./runtest "$(sed -n 7p .dpp/test_list)"
                    index=8; ./runtest "$(sed -n 8p .dpp/test_list)"
                    index=9; ./runtest "$(sed -n 9p .dpp/test_list)"
                    index=31; ./runtest "$(sed -n 31p .dpp/test_list)"
                    index=32; ./runtest "$(sed -n 32p .dpp/test_list)"
                    index=33; ./runtest "$(sed -n 33p .dpp/test_list)"
                    index=34; ./runtest "$(sed -n 34p .dpp/test_list)"
                    index=35; ./runtest "$(sed -n 35p .dpp/test_list)"
                    index=36; ./runtest "$(sed -n 36p .dpp/test_list)"
                    index=37; ./runtest "$(sed -n 37p .dpp/test_list)"
                    index=38; ./runtest "$(sed -n 38p .dpp/test_list)"
                    DPP_RUN_ERROR_CASE=1 ./runtest "Error cases"