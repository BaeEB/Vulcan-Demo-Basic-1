name: regression test

on:
    # push:
    workflow_dispatch:
            
jobs:
    checkout:
        runs-on: self-hosted
        steps:
            - name: checkout source code
              uses: actions/checkout@v2
    build:
        needs: checkout
        runs-on: self-hosted
        steps:
            - name: run build
              run: |
                    rm -rf build
                    cmake -B build . -DBUILD_SHARED_LIBS=OFF -DCMAKE_C_FLAGS="-fsanitize=address"
                    cd build; make -j10

    test:
        needs: build
        runs-on: self-hosted
        steps:
            - name: run test
              run: |
                    chmod -R 777 .; index=1; $(sed -n $1p .dpp/test_list)
                    chmod -R 777 .; index=2; $(sed -n $2p .dpp/test_list)
                    chmod -R 777 .; index=3; $(sed -n $3p .dpp/test_list)
                    chmod -R 777 .; index=4; $(sed -n $4p .dpp/test_list)
                    chmod -R 777 .; index=5; $(sed -n $5p .dpp/test_list)
                    chmod -R 777 .; index=6; $(sed -n $6p .dpp/test_list)
                    chmod -R 777 .; index=7; $(sed -n $7p .dpp/test_list)
                    chmod -R 777 .; index=8; $(sed -n $8p .dpp/test_list)
                    chmod -R 777 .; index=9; $(sed -n $9p .dpp/test_list)