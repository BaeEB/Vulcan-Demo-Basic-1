name: regression test

on:
    # push:
    workflow_dispatch:
            
jobs:
    checkout:
        runs-on: self-hosted
        steps:
            - name: checkout source code
              uses: actions/checkout@v2
    build:
        needs: checkout
        runs-on: self-hosted
        steps:
            - name: run build
              run: |
                    rm -rf build
                    cmake -B build .
                    cd build;  make -j10
                    find . -name $(sed -n '$p' ../.dpp/test_list) -exec mv {} ./tests \;

    test:
        needs: build
        runs-on: self-hosted
        steps:
            - name: run test
              run: |
                    cd tests; index=1; python3 ./runner.py tiff_test
                    cd tests; index=2; python3 ./runner.py bugfixes/redmine
                    cd tests; index=3; python3 ./runner.py test_issue_742.py  
