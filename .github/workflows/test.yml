name: regression test

on:
    # push:
    workflow_dispatch:
            
jobs:
    checkout:
        runs-on: self-hosted
        steps:
            - name: checkout source code
              uses: actions/checkout@v2
    build:
        needs: checkout
        runs-on: self-hosted
        steps:
            - name: run build
              run: |
                    rm -f Makefile
                    ./autogen.sh
                    make clean
                    make runtest -j10

    test:
        needs: build
        runs-on: self-hosted
        steps:
            - name: run test
              run: |
                    bash -c 'index=1; ./runtest "$(sed -n 1p .dpp/test_list)"'
                    bash -c 'index=2; ./runtest "$(sed -n 2p .dpp/test_list)"'
                    bash -c 'index=3; ./runtest "$(sed -n 3p .dpp/test_list)"'
                    bash -c 'index=4; ./runtest "$(sed -n 4p .dpp/test_list)"'
                    bash -c 'index=5; ./runtest "$(sed -n 5p .dpp/test_list)"'
                    bash -c 'index=6; ./runtest "$(sed -n 6p .dpp/test_list)"'
                    bash -c 'index=7; ./runtest "$(sed -n 7p .dpp/test_list)"'
                    bash -c 'index=8; ./runtest "$(sed -n 8p .dpp/test_list)"'
                    bash -c 'index=9; ./runtest "$(sed -n 9p .dpp/test_list)"'
                    bash -c 'index=10; ./runtest "$(sed -n 10p .dpp/test_list)"'
                    bash -c 'index=31; ./runtest "$(sed -n 31p .dpp/test_list)"'
                    bash -c 'index=32; ./runtest "$(sed -n 32p .dpp/test_list)"'
                    bash -c 'index=33; ./runtest "$(sed -n 33p .dpp/test_list)"'
                    bash -c 'index=34; ./runtest "$(sed -n 34p .dpp/test_list)"'
                    bash -c 'index=35; ./runtest "$(sed -n 35p .dpp/test_list)"'
                    bash -c 'index=36; ./runtest "$(sed -n 36p .dpp/test_list)"'
                    bash -c 'index=37; ./runtest "$(sed -n 37p .dpp/test_list)"'
                    bash -c 'index=38; ./runtest "$(sed -n 38p .dpp/test_list)"'
                    bash -c 'index=39; ./runtest "$(sed -n 39p .dpp/test_list)"'
                    bash -c 'index=40; ./runtest "$(sed -n 40p .dpp/test_list)"'
                    bash -c 'DPP_RUN_ERROR_CASE=1 ./runtest "Error cases regression tests" + "General documents valid regression tests"'
